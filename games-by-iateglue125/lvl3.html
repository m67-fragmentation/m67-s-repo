<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin: 0; overflow: hidden; background-color: #87CEEB }
        #Player { 
            position: absolute; 
            z-index: 10;
            transition: transform 0.1s
        }
        .paper-platform {
            position: absolute;
            height: 15px; 
            background-image: url('paper.png');
            background-size: 100% 100%;
            background-repeat: no-repeat;
            transition: opacity 0.3s, transform 0.3s
        }
        .shredded {
            transform: scale(0) rotate(20deg);
            opacity: 0;
            pointer-events: none
        }
        #DeathWall {
            position: absolute;
            width: 80px;
            height: 100%;
            background: linear-gradient(to right, rgba(255,0,0,0.8), rgba(255,0,0,0));
            border-left: 8px dashed yellow;
            left: -200px;
            top: 0;
            z-index: 15;
            display: none
        }
        .cannon {
            position: fixed; 
            width: 60px;
            height: 40px;
            left: 0px;
            border-radius: 0 10px 10px 0;
            z-index: 20
        }
        #ScissorCannon { background-color: #333 }
        #RockCannon { background-color: #a00 }
        .projectile {
            position: absolute;
            width: 50px;
            height: 40px;
            z-index: 4
        }
        #GameWorld {
            position: relative;
            width: 4500px;
            height: 100vh;
            transition: transform 0.1s ease-out
        }
    </style>
</head>
<body id="myBody" background="sky.png" style="background-repeat:repeat; background-size: 80%">
    <h1 align="center" style="position: fixed; width: 100%; pointer-events: none; font-family: sans-serif; z-index: 100;">
        <font color="red">Level 4</font>
    </h1>
    <div id="ScissorCannon" class="cannon" style="top: 200px"></div>
    <div id="RockCannon" class="cannon" style="top: 400px"></div>
    <div id="GameWorld">
        <div id="DeathWall"></div>
        <img id="Player" src="paper.png" style="position:absolute; width:100px; height:80px; left:100px; top:200px">
        <div id="PlatformContainer">
            <div class="paper-platform" style="width:250px; left:50px; top:450px"></div>
            <div class="paper-platform" style="width:150px; left:400px; top:400px"></div>
            <div class="paper-platform" style="width:150px; left:650px; top:320px"></div>
            <div class="paper-platform" style="width:200px; left:900px; top:450px"></div>
            <div class="paper-platform" style="width:150px; left:1200px; top:350px"></div>
            <div class="paper-platform" style="width:150px; left:1450px; top:250px"></div>
            <div class="paper-platform" style="width:200px; left:1700px; top:400px"></div>
            <div class="paper-platform" style="width:150px; left:2000px; top:320px"></div>
            <div class="paper-platform" style="width:180px; left:2250px; top:450px"></div>
            <div class="paper-platform" style="width:150px; left:2550px; top:350px"></div>
            <div class="paper-platform" style="width:150px; left:2850px; top:250px"></div>
            <div class="paper-platform" style="width:200px; left:3150px; top:400px"></div>
            <div class="paper-platform" style="width:150px; left:3450px; top:300px"></div>
            <div class="paper-platform" style="width:200px; left:3750px; top:450px"></div>
            <div class="paper-platform" style="width:400px; left:4050px; top:350px"></div>
        </div>
        <img id="myWin01" src="yellow.png" style="position:absolute; width:60px; height:100px; left:4350px; top:250px">
    </div>
<script>
    const config = { 
        gravity: 0.55, 
        jumpForce: -14, 
        acceleration: 0.9, 
        drag: 0.88, 
        deathY: 850,
        deathWallSpeed: 3.8 
    }

    let player, gameWorld, deathWall, myVelocityX = 0, myVelocityY = 1, isGrounded = false
    let playerState = 'paper', projectiles = [], cameraX = 0
    let deathWallActive = false, wallX = -200, deathWallTimer
    const keysDown = {}

    window.onload = function() {
        player = document.getElementById('Player')
        gameWorld = document.getElementById('GameWorld')
        deathWall = document.getElementById('DeathWall')
        updateState('paper')
        
        window.addEventListener('keydown', e => keysDown[e.key.toLowerCase()] = true)
        window.addEventListener('keyup', e => keysDown[e.key.toLowerCase()] = false)
        
        setInterval(gameLoop, 20)
        setInterval(() => fire('Scissors.png', 'scissor-proj'), 1500)
        setInterval(() => fire('rock.png', 'rock-proj'), 2000) 

        startDeathWallTimer()
    }

    function startDeathWallTimer() {
        if (deathWallTimer) clearTimeout(deathWallTimer)
        deathWallTimer = setTimeout(() => {
            deathWallActive = true
            deathWall.style.display = 'block'
        }, 1000)
    }

    function updateState(state) {
        playerState = state
        player.src = state === 'scissors' ? 'Scissors.png' : (state === 'rock' ? 'rock.png' : 'paper.png')
        if (state === 'rock') {
            player.style.width = '80px'; player.style.height = '80px'
        } else {
            player.style.width = '100px'; player.style.height = '80px'
        }
    }

    function fire(img, type) {
        if (parseFloat(player.style.left) < 300) return
        const cannon = (type === 'scissor-proj') ? document.getElementById('ScissorCannon') : document.getElementById('RockCannon')
        const proj = document.createElement('img')
        proj.src = img
        proj.className = 'projectile'
        proj.style.left = (Math.abs(cameraX) + 60) + 'px'
        proj.style.top = cannon.style.top
        gameWorld.appendChild(proj)
        projectiles.push({el: proj, type: type})
    }

    function gameLoop() {
        if (deathWallActive) {
            wallX += config.deathWallSpeed
            deathWall.style.left = wallX + 'px'
            if (parseFloat(player.style.left) < wallX + 40) reset() 
        }

        document.getElementById('ScissorCannon').style.top = (300 + Math.sin(Date.now()/800) * 200) + 'px'
        document.getElementById('RockCannon').style.top = (300 + Math.cos(Date.now()/1000) * 200) + 'px'

        for (let i = projectiles.length - 1; i >= 0; i--) {
            let p = projectiles[i]
            let pLeft = parseFloat(p.el.style.left)
            p.el.style.left = (pLeft + 10) + 'px'
            let r1 = player.getBoundingClientRect()
            let r2 = p.el.getBoundingClientRect()
            if (!(r1.right < r2.left + 10 || r1.left > r2.right - 10 || r1.bottom < r2.top + 10 || r1.top > r2.bottom - 10)) {
                updateState(p.type === 'rock-proj' ? 'rock' : 'scissors')
                p.el.remove(); projectiles.splice(i, 1)
            } else if (pLeft > Math.abs(cameraX) + window.innerWidth + 100) {
                p.el.remove(); projectiles.splice(i, 1)
            }
        }

        myVelocityX *= config.drag
        if (keysDown['a']) { myVelocityX -= config.acceleration; player.style.transform = 'scaleX(1)' } 
        if (keysDown['d']) { myVelocityX += config.acceleration; player.style.transform = 'scaleX(-1)' }
        
        let newX = (parseFloat(player.style.left) || 100) + myVelocityX
        player.style.left = Math.max(0, newX) + 'px'

        cameraX += (Math.min(0, -(newX - window.innerWidth/3)) - cameraX) * 0.1 
        gameWorld.style.transform = `translateX(${cameraX}px)`

        myVelocityY += config.gravity
        let currTop = parseFloat(player.style.top) || 200
        let onPlatform = false
        const b = player.getBoundingClientRect()

        document.querySelectorAll('.paper-platform:not(.shredded)').forEach(plat => {
            const r = plat.getBoundingClientRect()
            if (b.right > r.left + 5 && b.left < r.right - 5 && b.bottom <= r.top + 20 && b.bottom + myVelocityY >= r.top) {
                if (playerState === 'rock') { reset(); return }
                if (playerState === 'scissors') { plat.classList.add('shredded'); return }
                if (myVelocityY >= 0) {
                    player.style.top = (currTop + (r.top - b.bottom)) + 'px'
                    myVelocityY = 0
                    onPlatform = true
                }
            }
        })

        if (!onPlatform) player.style.top = (currTop + myVelocityY) + "px"
        isGrounded = onPlatform
        if (keysDown['w'] && isGrounded) { myVelocityY = config.jumpForce; isGrounded = false }

        let winRect = document.getElementById('myWin01').getBoundingClientRect()
        if (!(b.right < winRect.left || b.left > winRect.right || b.bottom < winRect.top || b.top > winRect.bottom)) {
            window.location.href = 'gameindex.html'
        }
        if (parseFloat(player.style.top) > config.deathY) reset()
    }

    function reset() {
        wallX = -200
        deathWallActive = false
        deathWall.style.display = 'none'
        startDeathWallTimer()
        player.style.left = '100px'
        player.style.top = '200px'
        myVelocityX = 0
        myVelocityY = 0
        updateState('paper')
        document.querySelectorAll('.shredded').forEach(p => p.classList.remove('shredded'))
        projectiles.forEach(p => p.el.remove())
        projectiles = []
    }
</script>
</body>
</html>
